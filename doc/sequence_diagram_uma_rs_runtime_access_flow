title Gluu PEP access

client->Kong Proxy: HTTP request

Kong Proxy->gluu-pep: ***** call "access" event for Kong plugin priority 998  *****

gluu-pep->gluu-pep: Get token from Authorization Header
alt missed token
    gluu-pep->client: 401/Unauthorized + ticket
end

gluu-pep<->gluu-pep: Lookup protected path

gluu-pep<->gluu-pep: Lookup token in cache

alt cache found
    opt token already authorized for this path/method
        gluu-pep->Kong Proxy: Access granted
    end
end

gluu-pep->gluu-pep: Lookup permission token in cache
opt no permission token in cache
    gluu-pep<->oxd: GET protection_access_token
end

gluu-pep<->oxd: introspect_rpt(rpt, protected path)
alt token not active
    gluu-pep->client: 401/Unauthorized
end

gluu-pep<->oxd: uma_rs_check_access(rpt, protected path)

alt access granted
    gluu-pep<->gluu-pep: update cache
    gluu-pep->Kong Proxy: Access granted
else
    gluu-pep->client: 403/Forbidden
end
